# 更新日志

**OOPS - One-click Operating Pre-check System (一键运行预检系统)**

## v0.1.4 - 2025-11-23 🚀

### 🎉 重大更新

本版本完成了大规模重构，显著提升了检测准确性和用户体验。

### ✨ 新功能

1. **统一报告格式**
   - 创建 `UnifiedDetectionRenderer` 统一渲染器
   - 所有检测结果使用相同的组织形式
   - 实现智能折叠：默认显示错误/警告，通过项可展开
   - 统一摘要格式：`✅ X项通过 | ⚠️ Y项警告 | ❌ Z项错误`

2. **自动模式**
   - 双击EXE或无参数启动时自动运行所有项目检测
   - 无需用户输入，自动生成报告并在浏览器中打开
   - 面向零门槛的用户体验设计

3. **硬件信息增强**
   - 添加显示器分辨率检测（跨平台支持）
   - 添加分辨率要求验证（可配置最低分辨率）
   - 绝区零项目要求最低分辨率 1920x1080

4. **网络检测优化**
   - 添加正确的层次结构显示
   - 主分类用 `【】` 标记
   - 子项使用 `└─` 符号和缩进
   - 修复计数问题（只计算分类数，不计算子项）

### 🐛 Bug修复

1. **HDR检测修复**
   - 修复使用 `BitsPerPixel > 24` 导致的误报问题
   - 改用正确的注册表键：`EnableHDR`
   - 不再误报深色模式为HDR

2. **夜间模式检测修复**
   - 修复只检查注册表键存在性的问题
   - 检查 `Data[18]` 字节值区分启用/禁用状态
   - 正确区分深色模式（UI主题）和夜间模式（色温调整）

3. **CSS样式修复**
   - 修复列表标记溢出问题
   - 修复文字溢出框外问题
   - 优化详细数据框内的列表样式
   - 改进响应式布局

### 🎨 改进

1. **系统信息优化**
   - 系统信息模块改为纯数据展示
   - 移除所有警告图标和验证逻辑
   - 默认折叠详细信息，只显示关键摘要
   - 验证逻辑移到独立的检测器

2. **检测顺序重组**
   - 实现自定义检测顺序
   - 新顺序：硬件信息 → 系统设置 → 网络 → Python环境 → 环境依赖 → 路径规范 → 游戏设置
   - 更符合逻辑的检测流程

### 🏗️ 架构改进

1. **代码重构**
   - 创建 `unified_renderer.py` 统一渲染器
   - 优化 `report_modules.py` 报告模块
   - 改进 `hardware.py` 硬件检测器
   - 重构 `system_settings.py` 系统设置检测器

2. **配置增强**
   - 添加 `hardware_requirements` 配置项
   - 支持最低分辨率要求配置
   - 更灵活的检测器配置

### 📚 文档

1. **新增文档**
   - `docs/dev/SESSION_SUMMARY_2025-11-23.md` - 会话总结
   - `docs/dev/NETWORK_DETECTOR_REFACTOR.md` - 网络检测器重构计划

2. **更新文档**
   - 更新 `REFACTOR_DETECTION_ORDER.md` 重构进度
   - 完善开发文档

### 📊 测试结果

| 检测项 | 修复前 | 修复后 |
|--------|--------|--------|
| HDR检测 | 误报 | ✅ 正确 |
| 夜间模式检测 | 误报 | ✅ 正确 |
| 分辨率检测 | 不支持 | ✅ 支持 |
| 网络检测显示 | 格式混乱 | ✅ 清晰 |
| 报告格式 | 不统一 | ✅ 统一 |

---

## v0.2.0 - 2025-11-23 🚀

### 🏗️ 架构重构

1. **检测顺序重组**
   - 重新设计检测流程：硬件→系统→设置→网络→Python环境→依赖→路径
   - 创建 4 个新检测器：`hardware.py`, `system.py`, `system_settings.py`, `python_environment.py`
   - 保持向后兼容性，旧检测器继续工作

2. **数据渲染分离**
   - 系统信息模块只展示纯数据，移除警告图标
   - 硬件适配验证逻辑独立为检测项
   - 开始实现"配置解析→执行→渲染"架构分离

### ✨ 新功能

1. **增强 Python 环境检测**
   - 支持多种包管理器识别：pip/conda/uv/poetry/pipenv
   - 智能虚拟环境检测（支持任意命名）
   - 完整依赖检查：缺失包、版本不匹配检测
   - 提供具体的修复建议

2. **统一检测规则**
   - 网络连通性检测显示完整结果（成功/失败比例）
   - 不再隐藏失败项，提供透明的检测信息
   - 所有检测器遵循统一的数据格式

### 🎨 改进

1. **系统信息优化**
   - 移除磁盘类型的警告图标（⚠️/✅）
   - 只显示纯数据，不进行验证判断
   - 更清晰的信息展示

2. **检测结果展示**
   - 按新的逻辑顺序组织报告
   - 更好的问题分类和优先级
   - 改进的用户体验

### 🔧 技术改进

1. **代码质量**
   - 新检测器采用统一的数据模型
   - 更好的错误处理和日志记录
   - 改进的测试覆盖

2. **性能优化**
   - 优化检测器执行顺序
   - 减少重复的系统调用
   - 更快的报告生成

### 📚 文档

1. **开发文档**
   - 新增 `REFACTOR_DETECTION_ORDER.md` 重构进度文档
   - 详细的架构变更记录
   - 完整的实施计划和进度跟踪

---

## 2025-11-22 (更新7)

### ✨ 新功能

1. **硬件适配检测章节**
   - 在检测结果中新增独立的"硬件适配"检测项
   - 自动从系统信息中提取硬件相关的验证结果
   - 包含内存、磁盘类型、用户名、显示设置等硬件适配问题
   - 提供针对性的修复建议

### 🎨 改进

1. **检测结果中文化**
   - 所有检测项名称改为中文显示
   - `system_info` → 系统信息
   - `network_connectivity` → 网络连通性
   - `environment_dependencies` → 环境依赖
   - `path_validation` → 路径规范
   - `hardware_compatibility` → 硬件适配

2. **报告布局优化**
   - "硬件验证"改名为"硬件适配"
   - 硬件适配问题在检测结果中独立显示
   - 更清晰的问题分类和展示

## 2025-11-22 (更新6)

### ✨ 新功能

1. **显示器分辨率检测与验证**
   - 在系统信息检测中添加主显示器分辨率检测
   - 跨平台支持（Windows/Linux/macOS）
   - 自动验证分辨率是否满足游戏脚本最低要求（1920x1080）
   - 分辨率过低时显示错误级别警告并提供修复建议
   - 在HTML报告的"显示设置"部分显示分辨率信息

### 🎨 改进

1. **报告布局优化**
   - 分辨率信息归类到"显示设置"部分
   - 与HDR、夜间模式、颜色滤镜等显示相关设置放在一起
   - 分辨率显示简洁，不带状态图标

2. **分辨率验证逻辑**
   - 低于 1920x1080：显示错误，提示"游戏脚本要求最低分辨率 1920x1080，请调整显示器分辨率"
   - 等于 1920x1080：通过验证，符合最低要求
   - 高于 1920x1080：通过验证，符合要求
   - 无法解析：显示警告，建议检查显示器设置

3. **检测方法**
   - Windows: 使用 PowerShell + System.Windows.Forms API
   - Linux: 使用 xrandr 命令
   - macOS: 使用 system_profiler 命令

## 2025-11-22 (更新5)

### ✨ 新功能

1. **图标支持**
   - 添加 OOPS 图标（oops.png / oops.ico）
   - 编译后的 exe 文件带有自定义图标
   - 支持多种尺寸（16x16 到 256x256）

### 🎨 改进

1. **修复建议优化**
   - 检测正常时不再显示"无需修复"建议
   - 只在有问题时显示修复建议
   - 报告更简洁，减少冗余信息

2. **构建配置更新**
   - 更新 build.spec 配置，添加图标支持
   - 更新构建脚本，使用正确的 spec 文件路径
   - 支持 Windows/Linux/macOS 多平台构建

## 2025-11-22 (更新4)

### ✨ 新功能

1. **显示设置检测增强**
   - 新增 HDR（高动态范围）检测功能
   - 检测 Windows 夜间模式/护眼模式状态
   - 检测 Windows 颜色滤镜状态
   - 检测 NVIDIA 游戏滤镜（进程检测）
   - 显示设置单独分类显示，更清晰
   - 自动验证显示设置是否影响游戏脚本识别

2. **报告显示优化**
   - 所有检测项默认隐藏成功详情，只展开失败和警告项
   - 成功项可通过"▶ 显示通过项 (N)"按钮查看
   - path_validation 等检测项的通过项默认折叠
   - 改善报告可读性，聚焦问题

### 🎨 改进

- 系统信息中的显示设置单独分类
- 显示设置状态用图标标识：✅ 正常 / ⚠️ 警告
- 报告更简洁，默认只显示需要关注的问题

## 2025-11-22 (更新3)

### ✨ 新功能

1. **显示设置检测**
   - 新增 HDR（高动态范围）检测功能
   - 检测 Windows 夜间模式状态
   - 自动验证显示设置是否影响游戏脚本识别
   - HDR 或夜间模式启用时给出警告和关闭建议

## 2025-11-22 (更新2)

### ✨ 新功能

1. **报告交互优化**
   - 系统信息默认折叠，显示紧凑摘要（CPU、内存、磁盘类型）
   - 网络检测结果优化：
     - **按类型分类显示**：Git仓库、PyPI源、镜像站点、GitHub代理等
     - 每个分类显示可用数量统计：`(3/5 可用)`
     - 优先显示可用源，不可用源折叠隐藏
     - 显示响应时间，便于选择最快的源
   - 添加折叠/展开按钮，改善大量信息的可读性

### 📚 文档

- 新增 `ARCHITECTURE.md` 架构文档
  - 详细说明执行器-报告器解耦设计
  - 标准化数据格式说明
  - 开发者指南

## 2025-11-22 (更新1)

### ✨ 新功能

1. **系统信息检测**
   - 新增系统信息检测器，自动收集 CPU、GPU、内存、存储等硬件信息
   - 检测当前运行路径和存储类型（SSD/HDD）
   - 自动验证硬件配置是否满足项目要求
   - HDD 磁盘会显示警告并提供 SSD 建议
   - **隐私保护**：移除用户名和计算机名显示，路径中的用户名替换为 `[USER]`
   - **用户名验证**：检测用户名是否为全英文无特殊字符，有问题时给出警告和建议

2. **报告模块化**
   - 将报告生成拆分为独立的模块（SystemInfoModule、SummaryModule、CheckResultsModule）
   - 支持更灵活的报告内容定制
   - 改进了报告的可维护性和扩展性

3. **Build 文件整理**
   - 创建 `build/` 目录统一管理构建相关文件
   - 分类存放：scripts（脚本）、config（配置）、docs（文档）、workflows（CI/CD）
   - 添加 build/README.md 说明文档

### 🎨 改进

- 系统信息在报告中以独立模块显示，包含基本信息、硬件信息、存储信息和硬件验证
- HDD 磁盘类型会以警告色显示，并提供 SSD 建议
- 报告 CSS 样式优化，新增系统信息网格布局
- 用户名验证：只在用户名不符合规范时显示警告（不显示用户名本身）
- 路径隐私保护：Python路径和当前路径中的用户名自动替换为 `[USER]`

### 📁 文件结构变化

```
build/
├── README.md
├── scripts/
│   ├── build.bat
│   ├── build.sh
│   ├── test_build.bat
│   └── deploy_to_project.bat
├── config/
│   └── build.spec
├── docs/
│   ├── BUILD.md
│   ├── BUILD_SUMMARY.md
│   ├── BUILD_QUICK_REFERENCE.md
│   └── RELEASE_CHECKLIST.md
└── workflows/
    └── build.yml

oops/
├── core/
│   └── report_modules.py  # 新增：报告模块化组件
└── detectors/
    └── system_info.py      # 新增：系统信息检测器
```

### 🔧 配置更新

- `configs/zenless_zone_zero.yaml` 新增 `system_info` 检测项配置
- 默认启用系统信息检测

### 📝 依赖更新

- 新增依赖：`psutil>=5.9.0` （用于系统信息收集）

### 🔒 隐私保护

- 移除报告中的用户名和计算机名显示
- Python路径和当前路径中的用户名自动替换为 `[USER]`
- 用户名验证功能：检测用户名规范性，但不显示用户名本身
- 只在用户名存在问题时显示警告和建议
